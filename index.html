<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: black;
    overflow: hidden;
    font-family: system-ui, sans-serif;
  }

  #camera {
    position: fixed;
    inset: 0;
    object-fit: cover;
    width: 100%;
    height: 100%;
    background: black;
  }

  #recordButton {
    position: fixed;
    bottom: 32px;
    left: 50%;
    transform: translateX(-50%);
    width: 84px;
    height: 84px;
    border-radius: 50%;
    background: #dc2626;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  #recordButton::after {
    content: "";
    width: 56px;
    height: 56px;
    background: white;
    border-radius: 50%;
  }

  svg {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) rotate(-90deg);
    pointer-events: none;
  }
</style>

<video id="camera" autoplay muted playsinline></video>

<!-- Progress ring -->
<svg width="120" height="120">
  <circle cx="60" cy="60" r="52"
    stroke="#ffffff55" stroke-width="6" fill="none" />
  <circle id="progress"
    cx="60" cy="60" r="52"
    stroke="#dc2626" stroke-width="6" fill="none"
    stroke-linecap="round"
    stroke-dasharray="326.7"
    stroke-dashoffset="326.7" />
</svg>

<div id="recordButton"></div>

<script>
(() => {
  const video = document.getElementById("camera");
  const button = document.getElementById("recordButton");
  const ring = document.getElementById("progress");

  const MAX_TIME = 15000;
  const CIRC = 326.7;

  let recorder, chunks = [], startTime, timer;

  async function initCamera() {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: {
        facingMode: "user",
        aspectRatio: 9 / 16,
        width: { ideal: 720 },
        height: { ideal: 1280 }
      },
      audio: true
    });
    video.srcObject = stream;
    return stream;
  }

  function updateRing(elapsed) {
    const p = Math.min(elapsed / MAX_TIME, 1);
    ring.style.strokeDashoffset = CIRC * (1 - p);
  }

  async function startRecording() {
    button.style.pointerEvents = "none";
    ring.style.strokeDashoffset = CIRC;

    const stream = await initCamera();
    chunks = [];

    recorder = new MediaRecorder(stream, { mimeType: "video/webm" });

    recorder.ondataavailable = e => e.data.size && chunks.push(e.data);

    recorder.onstop = async () => {
      clearInterval(timer);
      stream.getTracks().forEach(t => t.stop());

      const blob = new Blob(chunks, { type: "video/webm" });
      const file = new File([blob], "video-15s.webm", {
        type: "video/webm"
      });

      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        await navigator.share({
          title: "My video",
          files: [file]
        });
      }

      button.style.pointerEvents = "auto";
      ring.style.strokeDashoffset = CIRC;
    };

    recorder.start();
    startTime = Date.now();

    timer = setInterval(() => {
      updateRing(Date.now() - startTime);
    }, 50);

    setTimeout(() => recorder.stop(), MAX_TIME);
  }

  button.addEventListener("click", startRecording);
})();
</script>
